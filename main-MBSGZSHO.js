import{b as st}from"./chunk-HY74IRL2.js";import{$ as Ye,A as Le,Aa as W,B as Be,Ba as H,C as De,Ca as ue,D as y,Da as D,E as n,Ea as q,F as s,Fa as z,G as p,Ga as K,H as Ge,Ha as Z,I as u,Ia as $,J as Ve,Ja as nt,Ka as J,O as m,Q as We,R as He,T as qe,V as ze,W as j,X as Ke,Y as Ze,Z as $e,_ as Je,a as Pe,aa as Qe,ba as Xe,ca as et,d as me,da as tt,e as ce,ea as w,f as X,fa as rt,g as ee,ga as ie,h as U,ha as d,i as Fe,ia as k,j as T,ja as b,ka as x,l as te,la as A,m as re,ma as O,n as f,na as R,o as je,oa as L,p as P,pa as B,q as g,qa as it,r as ke,ra as le,s as xe,sa as pe,t as Ae,ta as G,u as Oe,v as Re,va as E,w as C,wa as V,x as a,y as S,ya as F,z as h,za as ot}from"./chunk-XVE5IWEF.js";var at=()=>{let t=g(w);return g(d).isLoggedIn()?(t.navigate(["/notes"]),!1):!0};var mt=()=>{let t=g(w);return g(d).isLoggedIn()?!0:(t.navigate(["/login"]),!1)};var M=class t{constructor(r,e){this.http=r;this.authService=e}url=`${le.apiUrl}/users`;getUser(){return X(this.http.get(this.url,{headers:this.authService.authHeaders}))}createUser(r){return X(this.http.post(this.url,r))}changePassword(r){return X(this.http.put(this.url,r,{headers:this.authService.authHeaders}))}deleteUser(r){return X(this.http.delete(this.url,{headers:this.authService.authHeaders,body:r}))}static \u0275fac=function(e){return new(e||t)(P(Ke),P(d))};static \u0275prov=re({token:t,factory:t.\u0275fac,providedIn:"root"})};var wt=()=>["/login"],ge=class t{constructor(r,e,i,o,l,c){this.formBuilder=r;this.usersService=e;this.toastService=i;this.router=o;this.authService=l;this.loadingService=c}userCreateForm;ngOnInit(){this.userCreateForm=this.buildUserCreateForm()}register(){this.userCreateForm.valid&&(this.loadingService.changeLoadingState(!0),this.usersService.createUser(this.userCreateForm.value).then(r=>{this.authService.login(r),this.toastService.openSuccessToast(`Witaj ${this.userCreateForm.get("username")?.value}`),this.router.navigate(["/notes"])}).catch(r=>this.toastService.openErrorFromApiToast(r)).finally(()=>this.loadingService.changeLoadingState(!1)))}buildUserCreateForm(){return this.formBuilder.group({username:["",b.required],password:["",b.required],password2:["",b.required]})}static \u0275fac=function(e){return new(e||t)(a(B),a(M),a(E),a(w),a(d),a(D))};static \u0275cmp=S({type:t,selectors:[["app-user-create"]],standalone:!1,decls:23,vars:3,consts:[[1,"d-flex","flex-column","align-items-center","mt-5",3,"ngSubmit","formGroup"],["matInput","","formControlName","username"],["matInput","","type","password","formControlName","password"],["matInput","","type","password","formControlName","password2"],["mat-button",""],["mat-button","","type","button",3,"routerLink"]],template:function(e,i){e&1&&(n(0,"form",0),u("ngSubmit",function(){return i.register()}),n(1,"mat-form-field")(2,"mat-label"),m(3,"Nazwa u\u017Cytkownika"),s(),p(4,"input",1),n(5,"mat-error"),m(6,"Pole wymagane!"),s()(),n(7,"mat-form-field")(8,"mat-label"),m(9,"Has\u0142o"),s(),p(10,"input",2),n(11,"mat-error"),m(12,"Pole wymagane!"),s()(),n(13,"mat-form-field")(14,"mat-label"),m(15,"Powt\xF3rz has\u0142o"),s(),p(16,"input",3),n(17,"mat-error"),m(18,"Pole wymagane!"),s()(),n(19,"button",4),m(20,"Stw\xF3rz konto"),s(),n(21,"button",5),m(22,"Wr\xF3\u0107 do logowania"),s()()),e&2&&(y("formGroup",i.userCreateForm),C(21),y("routerLink",He(2,wt)))},dependencies:[K,q,z,Z,G,rt,O,k,x,A,R,L],styles:["form[_ngcontent-%COMP%]{gap:10px}"]})};var ut=()=>{let t=g(w);return g(d).isLoggedIn()?(t.navigate(["/notes"]),!1):!0};var bt=[{path:"login",loadChildren:()=>import("./chunk-A3C2T7C7.js").then(t=>t.LoginModule),canMatch:[at]},{path:"notes",loadChildren:()=>import("./chunk-5U4TV727.js").then(t=>t.NotesModule),canMatch:[mt]},{path:"register",component:ge,canActivate:[ut]},{path:"**",redirectTo:"login"}],he=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=h({type:t});static \u0275inj=f({imports:[ie.forRoot(bt),ie]})};var ve=class t{constructor(r,e,i,o,l,c,I){this.dialogRef=r;this.dialog=e;this.usersService=i;this.authService=o;this.toastService=l;this.formBuilder=c;this.loadingService=I}passwordForm;ngOnInit(){this.passwordForm=this.buildPasswordForm()}cancel(){this.dialogRef.close(),this.dialog.open(_)}confirm(){this.passwordForm.markAllAsTouched(),this.passwordForm.valid&&(this.loadingService.changeLoadingState(!0),this.usersService.deleteUser(this.passwordForm.value).then(()=>{this.authService.logout(),this.toastService.openSuccessToast("Konto usuni\u0119te!"),this.dialogRef.close()}).catch(r=>this.toastService.openErrorFromApiToast(r)).finally(()=>this.loadingService.changeLoadingState(!1)))}buildPasswordForm(){return this.formBuilder.group({password:["",b.required]})}static \u0275fac=function(e){return new(e||t)(a(V),a(F),a(M),a(d),a(E),a(B),a(D))};static \u0275cmp=S({type:t,selectors:[["app-user-delete-confirm"]],standalone:!1,decls:17,vars:1,consts:[[1,"d-flex","flex-column","align-items-center"],["mat-dialog-title",""],[3,"ngSubmit","formGroup"],["matInput","","type","password","formControlName","password"],["type","submit","hidden",""],["id","confirm","mat-button","",3,"click"],["mat-button","",3,"click"]],template:function(e,i){e&1&&(n(0,"div",0)(1,"h1",1),m(2,"Jeste\u015B pewien?"),s(),n(3,"mat-dialog-content")(4,"form",2),u("ngSubmit",function(){return i.confirm()}),n(5,"mat-form-field")(6,"mat-label"),m(7,"Podaj has\u0142o"),s(),p(8,"input",3),n(9,"mat-error"),m(10,"Pole wymagane!"),s(),p(11,"input",4),s()()(),n(12,"mat-dialog-actions")(13,"button",5),u("click",function(){return i.confirm()}),m(14,"Tak"),s(),n(15,"button",6),u("click",function(){return i.cancel()}),m(16,"Nie"),s()()()),e&2&&(C(4),y("formGroup",i.passwordForm))},dependencies:[K,q,z,Z,G,W,ue,H,O,k,x,A,R,L],styles:["#confirm[_ngcontent-%COMP%]{color:red}"]})};var Se=class t{constructor(r,e,i,o,l,c){this.dialog=r;this.dialogRef=e;this.formBuilder=i;this.usersService=o;this.toastService=l;this.loadingService=c}changePasswordForm;ngOnInit(){this.changePasswordForm=this.buildChangePasswordForm()}cancel(){this.dialog.open(_),this.dialogRef.close()}changePassword(){this.changePasswordForm.markAllAsTouched(),this.changePasswordForm.valid&&(this.loadingService.changeLoadingState(!0),this.usersService.changePassword(this.changePasswordForm.value).then(()=>{this.toastService.openSuccessToast("Has\u0142o zmienione!"),this.dialogRef.close()}).catch(r=>this.toastService.openErrorFromApiToast(r)).finally(()=>this.loadingService.changeLoadingState(!1)))}buildChangePasswordForm(){return this.formBuilder.group({oldPassword:["",b.required],password:["",b.required],password2:["",b.required]})}static \u0275fac=function(e){return new(e||t)(a(F),a(V),a(B),a(M),a(E),a(D))};static \u0275cmp=S({type:t,selectors:[["app-user-password-change"]],standalone:!1,decls:31,vars:1,consts:[[1,"d-flex","flex-column","align-items-center"],["mat-dialog-title",""],[1,"d-flex","flex-column","align-items-center",3,"ngSubmit","formGroup"],["matInput","","type","password","formControlName","oldPassword"],["matInput","","type","password","formControlName","password"],["matInput","","type","password","formControlName","password2"],["type","submit","hidden",""],["mat-icon-button","",3,"click"]],template:function(e,i){e&1&&(n(0,"div",0)(1,"h1",1),m(2,"Zmiana has\u0142a"),s(),n(3,"mat-dialog-content")(4,"form",2),u("ngSubmit",function(){return i.changePassword()}),n(5,"mat-form-field")(6,"mat-label"),m(7,"Stare has\u0142o"),s(),p(8,"input",3),n(9,"mat-error"),m(10,"Pole wymagane!"),s()(),n(11,"mat-form-field")(12,"mat-label"),m(13,"Nowe has\u0142o"),s(),p(14,"input",4),n(15,"mat-error"),m(16,"Pole wymagane!"),s()(),n(17,"mat-form-field")(18,"mat-label"),m(19,"Powt\xF3rz has\u0142o"),s(),p(20,"input",5),n(21,"mat-error"),m(22,"Pole wymagane!"),s()(),p(23,"input",6),s()(),n(24,"mat-dialog-actions")(25,"button",7),u("click",function(){return i.changePassword()}),n(26,"mat-icon"),m(27,"done"),s()(),n(28,"button",7),u("click",function(){return i.cancel()}),n(29,"mat-icon"),m(30,"cancel"),s()()()()),e&2&&(C(4),y("formGroup",i.changePasswordForm))},dependencies:[K,q,z,Z,pe,W,ue,H,$,O,k,x,A,R,L],styles:["form[_ngcontent-%COMP%]{gap:10px}"]})};var _=class t{constructor(r,e,i,o,l){this.usersService=r;this.toastService=e;this.dialogRef=i;this.authService=o;this.dialog=l}username="Unknown";ngOnInit(){this.getUser()}getUser(){this.usersService.getUser().then(r=>{r!==null&&(this.username=r)}).catch(r=>this.toastService.openErrorFromApiToast(r))}logout(){this.authService.logout(),this.toastService.openSuccessToast("Wylogowano!"),this.dialogRef.close()}deleteAccount(){this.dialog.open(ve),this.dialogRef.close()}changePassword(){this.dialog.open(Se),this.dialogRef.close()}static \u0275fac=function(e){return new(e||t)(a(M),a(E),a(V),a(d),a(F))};static \u0275cmp=S({type:t,selectors:[["app-user-settings"]],standalone:!1,decls:13,vars:1,consts:[[1,"d-flex","flex-column","align-items-center"],["mat-dialog-close","","mat-icon-button","",1,"align-self-end","mt-2","me-2"],["mat-dialog-title",""],[1,"d-flex","flex-column"],["mat-button","",3,"click"],["id","removeAccount","mat-button","",3,"click"]],template:function(e,i){e&1&&(n(0,"div",0)(1,"button",1)(2,"mat-icon"),m(3,"close"),s()(),n(4,"h1",2),m(5),s(),n(6,"mat-dialog-content",3)(7,"button",4),u("click",function(){return i.changePassword()}),m(8,"Zmie\u0144 has\u0142o"),s(),n(9,"button",4),u("click",function(){return i.logout()}),m(10,"Wyloguj si\u0119"),s(),n(11,"button",5),u("click",function(){return i.deleteAccount()}),m(12,"Usu\u0144 konto"),s()()()),e&2&&(C(5),We("Witaj ",i.username,""))},dependencies:[G,pe,ot,W,H,$],styles:["mat-dialog-content[_ngcontent-%COMP%]{overflow:hidden}#removeAccount[_ngcontent-%COMP%]{color:red}"]})};function Mt(t,r){if(t&1){let e=Ge();n(0,"mat-icon",3),u("click",function(){xe(e);let o=Ve();return Ae(o.openUserSettings())}),m(1,"settings"),s()}}var Ce=class t{constructor(r,e){this.authService=r;this.dialog=e}openUserSettings(){this.dialog.open(_)}static \u0275fac=function(e){return new(e||t)(a(d),a(F))};static \u0275cmp=S({type:t,selectors:[["app-header"]],standalone:!1,decls:5,vars:1,consts:[[1,"d-flex","justify-content-between","fs-1","fw-bold"],["src","favicon.ico","width","48"],[3,"click",4,"ngIf"],[3,"click"]],template:function(e,i){e&1&&(n(0,"mat-toolbar",0),p(1,"img",1),m(2," Notki "),n(3,"span"),Le(4,Mt,2,0,"mat-icon",2),s()()),e&2&&(C(4),y("ngIf",i.authService.isLoggedIn()))},dependencies:[ze,nt,$],styles:["mat-icon[_ngcontent-%COMP%]{cursor:pointer}span[_ngcontent-%COMP%]{width:48px}"]})};var we=class t{constructor(r,e){this.router=r;this.loadingService=e}navEventsSubscription;ngOnInit(){this.navEventsSubscription=this.router.events.subscribe(r=>{r instanceof Ye?this.loadingService.changeLoadingState(!0):(r instanceof Qe||r instanceof Xe||r instanceof et)&&this.loadingService.changeLoadingState(!1)})}ngOnDestroy(){this.navEventsSubscription.unsubscribe()}static \u0275fac=function(e){return new(e||t)(a(w),a(D))};static \u0275cmp=S({type:t,selectors:[["app-root"]],standalone:!1,decls:2,vars:0,template:function(e,i){e&1&&p(0,"app-header")(1,"router-outlet")},dependencies:[tt,Ce],encapsulation:2})};var be=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=h({type:t});static \u0275inj=f({imports:[j,J]})};var It={url:le.apiUrl},Me=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=h({type:t});static \u0275inj=f({imports:[st.forRoot(It)]})};var ye=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=h({type:t});static \u0275inj=f({imports:[j,J,ie,it]})};var Ie=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=h({type:t});static \u0275inj=f({imports:[j,J]})};var ne="Service workers are disabled or not supported by this browser",Y=class{serviceWorker;worker;registration;events;constructor(r,e){if(this.serviceWorker=r,!r)this.worker=this.events=this.registration=new me(i=>i.error(new Error(ne)));else{let i=null,o=new ce;this.worker=new me(N=>(i!==null&&N.next(i),o.subscribe(ae=>N.next(ae))));let l=()=>{let{controller:N}=r;N!==null&&(i=N,o.next(i))};r.addEventListener("controllerchange",l),l(),this.registration=this.worker.pipe(te(()=>r.getRegistration()));let c=new ce;this.events=c.asObservable();let I=N=>{let{data:ae}=N;ae?.type&&c.next(ae)};r.addEventListener("message",I),e?.get(De,null,{optional:!0})?.onDestroy(()=>{r.removeEventListener("controllerchange",l),r.removeEventListener("message",I)})}}postMessage(r,e){return new Promise(i=>{this.worker.pipe(T(1)).subscribe(o=>{o.postMessage(Pe({action:r},e)),i()})})}postMessageWithOperation(r,e,i){let o=this.waitForOperationCompleted(i),l=this.postMessage(r,e);return Promise.all([l,o]).then(([,c])=>c)}generateNonce(){return Math.round(Math.random()*1e7)}eventsOfType(r){let e;return typeof r=="string"?e=i=>i.type===r:e=i=>r.includes(i.type),this.events.pipe(Fe(e))}nextEventOfType(r){return this.eventsOfType(r).pipe(T(1))}waitForOperationCompleted(r){return new Promise((e,i)=>{this.eventsOfType("OPERATION_COMPLETED").pipe(Fe(o=>o.nonce===r),T(1),ee(o=>{if(o.result!==void 0)return o.result;throw new Error(o.error)})).subscribe({next:e,error:i})})}get isEnabled(){return!!this.serviceWorker}},gt=(()=>{class t{sw;messages;notificationClicks;subscription;get isEnabled(){return this.sw.isEnabled}pushManager=null;subscriptionChanges=new ce;constructor(e){if(this.sw=e,!e.isEnabled){this.messages=U,this.notificationClicks=U,this.subscription=U;return}this.messages=this.sw.eventsOfType("PUSH").pipe(ee(o=>o.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(ee(o=>o.data)),this.pushManager=this.sw.registration.pipe(ee(o=>o.pushManager));let i=this.pushManager.pipe(te(o=>o.getSubscription()));this.subscription=new me(o=>{let l=i.subscribe(o),c=this.subscriptionChanges.subscribe(o);return()=>{l.unsubscribe(),c.unsubscribe()}})}requestSubscription(e){if(!this.sw.isEnabled||this.pushManager===null)return Promise.reject(new Error(ne));let i={userVisibleOnly:!0},o=this.decodeBase64(e.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),l=new Uint8Array(new ArrayBuffer(o.length));for(let c=0;c<o.length;c++)l[c]=o.charCodeAt(c);return i.applicationServerKey=l,new Promise((c,I)=>{this.pushManager.pipe(te(Q=>Q.subscribe(i)),T(1)).subscribe({next:Q=>{this.subscriptionChanges.next(Q),c(Q)},error:I})})}unsubscribe(){if(!this.sw.isEnabled)return Promise.reject(new Error(ne));let e=i=>{if(i===null)throw new Error("Not subscribed to push notifications.");return i.unsubscribe().then(o=>{if(!o)throw new Error("Unsubscribe failed!");this.subscriptionChanges.next(null)})};return new Promise((i,o)=>{this.subscription.pipe(T(1),te(e)).subscribe({next:i,error:o})})}decodeBase64(e){return atob(e)}static \u0275fac=function(i){return new(i||t)(P(Y))};static \u0275prov=re({token:t,factory:t.\u0275fac})}return t})(),ht=(()=>{class t{sw;versionUpdates;unrecoverable;get isEnabled(){return this.sw.isEnabled}constructor(e){if(this.sw=e,!e.isEnabled){this.versionUpdates=U,this.unrecoverable=U;return}this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(ne));let e=this.sw.generateNonce();return this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:e},e)}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(ne));let e=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:e},e)}static \u0275fac=function(i){return new(i||t)(P(Y))};static \u0275prov=re({token:t,factory:t.\u0275fac})}return t})();var vt=new je("");function Et(){let t=g(se);if(!("serviceWorker"in navigator&&t.enabled!==!1))return;let r=g(vt),e=g(Re),i=g(De);e.runOutsideAngular(()=>{let o=navigator.serviceWorker,l=()=>o.controller?.postMessage({action:"INITIALIZE"});o.addEventListener("controllerchange",l),i.onDestroy(()=>{o.removeEventListener("controllerchange",l)})}),e.runOutsideAngular(()=>{let o,{registrationStrategy:l}=t;if(typeof l=="function")o=new Promise(c=>l().subscribe(()=>c()));else{let[c,...I]=(l||"registerWhenStable:30000").split(":");switch(c){case"registerImmediately":o=Promise.resolve();break;case"registerWithDelay":o=ft(+I[0]||0);break;case"registerWhenStable":o=Promise.race([i.whenStable(),ft(+I[0])]);break;default:throw new Error(`Unknown ServiceWorker registration strategy: ${t.registrationStrategy}`)}}o.then(()=>navigator.serviceWorker.register(r,{scope:t.scope}).catch(c=>console.error("Service worker registration failed with:",c)))})}function ft(t){return new Promise(r=>setTimeout(r,t))}function Ft(t,r){return new Y(t.enabled!==!1?navigator.serviceWorker:void 0,r)}var se=class{enabled;scope;registrationStrategy};function Dt(t,r={}){return ke([gt,ht,{provide:vt,useValue:t},{provide:se,useValue:r},{provide:Y,useFactory:Ft,deps:[se,Oe]},Be(Et)])}var St=(()=>{class t{static register(e,i={}){return{ngModule:t,providers:[Dt(e,i)]}}static \u0275fac=function(i){return new(i||t)};static \u0275mod=h({type:t});static \u0275inj=f({providers:[gt,ht]})}return t})();var Ee=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=h({type:t,bootstrap:[we]});static \u0275inj=f({providers:[Ze()],imports:[Je,he,be,Me,ye,Ie,St.register("ngsw-worker.js",{enabled:!qe(),registrationStrategy:"registerWhenStable:30000"})]})};$e().bootstrapModule(Ee,{ngZoneEventCoalescing:!0}).catch(t=>console.error(t));
